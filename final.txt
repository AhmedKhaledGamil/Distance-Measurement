#include "stdint.h"
#include "tm4c123gh6pm.h"

void SystemInit(){};
	

	
const double _16MHz_1clock = 62.5e-9;
const uint32_t MULTIPLIER  = 17150;  /*Derived from speed*/
		double difference;
	uint32_t time1,time2 ;
void init () { uint32_t i ;
	//pin configurations for port F and B 
  SYSCTL_RCGCGPIO_R |= 0x22;
	i=3;
	SYSCTL_RCGCTIMER_R |= 0x04;
	i=55;
	//while((SYSCTL_PRGPIO_R & 0x022)!=0x22){}
		GPIO_PORTF_LOCK_R = 0x4C4F434B ;
		GPIO_PORTB_LOCK_R = 0x4C4F434B ;
	GPIO_PORTB_CR_R = 0x07;	
  GPIO_PORTF_CR_R = 0x1f;
	GPIO_PORTF_DIR_R = 0x06;
	GPIO_PORTB_DIR_R = 0x06;
	GPIO_PORTF_AFSEL_R = 0;
	GPIO_PORTB_AFSEL_R |= 0x01;	
	GPIO_PORTF_PCTL_R = 0;
	GPIO_PORTB_PCTL_R &= ~0x00000fff;
	GPIO_PORTB_PCTL_R |= 0x7;	
	GPIO_PORTF_DEN_R |= 0x1f ;
	GPIO_PORTB_DEN_R |= 0x07  ;	
  GPIO_PORTF_AMSEL_R = 0   ;
	GPIO_PORTB_AMSEL_R = 0   ;	
	}


	void hobaa()
	{
		TIMER2_CTL_R &= ~0x01;
	TIMER2_CFG_R |= 0x04;
	TIMER2_TAMR_R |= 0x17;
	TIMER2_CTL_R |= 0x0C;	
	//TIMER2_TAILR_R = 0x00010000;	
  TIMER2_CTL_R |= 1;	
	}
	void delay_systick(uint32_t count)
	{
		NVIC_ST_CTRL_R = 0 ;
		NVIC_ST_RELOAD_R  = 160 ;  /// 1 millisecond    
		NVIC_ST_CURRENT_R  = 0 ;       // clear value in the current_r and clear the count flag
		NVIC_ST_CTRL_R = 5 ;
		while(!(NVIC_ST_CTRL_R&0x10000))
		{};
	}		
	void delay_times_systick(int times)
	{
		int i=0;
		for(i=0;i<times;i++)
		{
			delay_systick(160);
		}
	}
	
uint32_t timer_init ()
	{
	// timer configuration for pin PF0 T0CCP0 
		

		//timer0_flag_clear_portB =1 ;
		GPIO_PORTB_DATA_R &= ~0x02;
		delay_times_systick(1);
	GPIO_PORTB_DATA_R |= 0x02;
	///delay 10 micro
		delay_times_systick(1);
 	GPIO_PORTB_DATA_R &= ~0x02;
		TIMER2_ICR_R |= 0x04; 
	while((TIMER2_RIS_R&0x04)==0){};
	 time1 = TIMER2_TAR_R;
	//timer0_flag_clear_portB =1 ;	
		TIMER2_ICR_R |= 0x04;
	while((TIMER2_RIS_R&0x04)==0){};
		 time2 = TIMER2_TAR_R;
		//timer0_flag_clear_portB =1 ;
	difference= (time2-time1) ;
		difference = _16MHz_1clock *(double) MULTIPLIER *(double)difference;
return difference;		
  	
}		
	int main ()
	{
		
init() ;
	GPIO_PORTF_DATA_R = 0x00;
	while(1){
		
		hobaa();
		timer_init();
		
	
	 if(timer_init()<20)
	 GPIO_PORTF_DATA_R |= 0x02;
	 else
		 GPIO_PORTF_DATA_R = 0;
	
		delay_times_systick(8);
	}



	}









	
	/*
	void portF_init()
	{
		uint32_t delay;
		SYSCTL_RCGCGPIO_R |= 0X20;
		delay=2; // dummy variable
		GPIO_PORTF_LOCK_R = 0X4C4F434B;
		GPIO_PORTF_CR_R = 0x1F;
		GPIO_PORTF_DIR_R = 0x0E;
		GPIO_PORTF_PUR_R = 0x11;
		GPIO_PORTF_DEN_R = 0x1F;
		GPIO_PORTF_PCTL_R = 0;
		GPIO_PORTF_AMSEL_R =0;
		GPIO_PORTF_AFSEL_R = 0;
		
	}
	
	void initialize_systick()
	{
		NVIC_ST_CTRL_R = 0 ;
		NVIC_ST_RELOAD_R  = 0 ;  /// 1 millisecond    
		NVIC_ST_CURRENT_R  = 0 ;       // clear value in the current_r and clear the count flag
		NVIC_ST_CTRL_R = 5 ;
	}
	
	
	void delay_systick(uint32_t count)
	{
		NVIC_ST_CTRL_R = 0 ;
		NVIC_ST_RELOAD_R  = count ;  /// 1 millisecond    
		NVIC_ST_CURRENT_R  = 0 ;       // clear value in the current_r and clear the count flag
		NVIC_ST_CTRL_R = 5 ;
		while(!(NVIC_ST_CTRL_R&0x10000))
		{};
	}		
	void delay_times_systick(int times,uint32_t count)
	{
		int i=0;
		for(i=0;i<times;i++)
		{
			delay_systick(count);
		}
	}
	*/
	
	
	/*
	portF_init();
		
		while(1)
		{
			if((GPIO_PORTF_DATA_R & 0x11 )== 0x01)   // switch 4 is closed // switch 1 is open
					GPIO_PORTF_DATA_R = 0x02;
			else if((GPIO_PORTF_DATA_R & 0x11) == 0x10)
					GPIO_PORTF_DATA_R = 0x04;
			else if((GPIO_PORTF_DATA_R & 0x11) ==0x00)
					GPIO_PORTF_DATA_R= 0x08;
			else
					GPIO_PORTF_DATA_R= 0;
					
			
			
		}
	int count = 0 ;
		portF_init();
		
		GPIO_PORTF_DATA_R &= 0xFFFFFFF1;  // 
		//initialize_systick();
		while(1)
		{
				
			
			delay_times_systick(1,15999999);
			GPIO_PORTF_DATA_R ^= 0x02;    // Red led toggles every second
			count++;
			if(count==2 || count==4)
			{
				GPIO_PORTF_DATA_R ^= 0x04;  //  Blue led toggles every 2 seconds
			}
			if(count==4)
			{
				GPIO_PORTF_DATA_R ^= 0x08;  //  green led toggles every 4 seconds
				count=0;
			}
			
		}
	*/
	
	